import datetime

from grafanalib.core import Row
from itertools import groupby


class A11yDashboard:
    def __init__(self, name: str, properties: [str], source: str, operating_software: str, specification: str = None):
        self.title = " ".join([name, specification]) + " accessibility dashboard"
        self.properties = self.get_grafana_rows(properties)
        self.source = source
        self.operating_software = operating_software

    @staticmethod
    def get_grafana_rows(properties) -> {}:
        sorted_properties = sorted(properties, key=lambda x: x["feature"])
        # properties = [{'feature': 'accessibility_features', 'option': '1+', 'amount': 428496, 'percentage': '56.92', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_features', 'option': '2+', 'amount': 155068, 'percentage': '20.6', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'preference_daytime', 'option': 'day', 'amount': 294371, 'percentage': '39.11', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_accessibility_manager_enabled', 'option': 'true', 'amount': 76871, 'percentage': '10.21', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_closed_captioning_enabled', 'option': 'true', 'amount': 24482, 'percentage': '3.25', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_touch_exploration_enabled', 'option': 'true', 'amount': 11, 'percentage': '0', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_voice_access_enabled', 'option': 'true', 'amount': 69, 'percentage': '0.01', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_talk_back_enabled', 'option': 'true', 'amount': 10, 'percentage': '0', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_samsung_talk_back_enabled', 'option': 'true', 'amount': 1, 'percentage': '0', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_select_to_speak_enabled', 'option': 'true', 'amount': 532, 'percentage': '0.07', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_braille_back_enabled', 'option': 'true', 'amount': 1, 'percentage': '0', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_color_blind_mode_enabled', 'option': 'true', 'amount': 1678, 'percentage': '0.22', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_color_inversion_enabled', 'option': 'true', 'amount': 20, 'percentage': '0', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_switch_access_enabled', 'option': 'true', 'amount': 955, 'percentage': '0.13', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'preference_is_nightmode_enabled', 'option': 'true', 'amount': 133433, 'percentage': '17.73', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'default_screen_font_scale', 'option': 'true', 'amount': 472851, 'percentage': '62.82', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'default_screen_display_scale', 'option': 'true', 'amount': 581815, 'percentage': '77.29', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_accessibility_manager_enabled', 'option': 'false', 'amount': 675872, 'percentage': '89.79', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_closed_captioning_enabled', 'option': 'false', 'amount': 728261, 'percentage': '96.75', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_touch_exploration_enabled', 'option': 'false', 'amount': 752732, 'percentage': '100', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_voice_access_enabled', 'option': 'false', 'amount': 752674, 'percentage': '99.99', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_talk_back_enabled', 'option': 'false', 'amount': 752733, 'percentage': '100', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_samsung_talk_back_enabled', 'option': 'false', 'amount': 752742, 'percentage': '100', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_select_to_speak_enabled', 'option': 'false', 'amount': 752211, 'percentage': '99.93', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_braille_back_enabled', 'option': 'false', 'amount': 752742, 'percentage': '100', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_color_blind_mode_enabled', 'option': 'false', 'amount': 751065, 'percentage': '99.78', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_color_inversion_enabled', 'option': 'false', 'amount': 752723, 'percentage': '100', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'accessibility_is_switch_access_enabled', 'option': 'false', 'amount': 751788, 'percentage': '99.87', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'preference_is_nightmode_enabled', 'option': 'false', 'amount': 557582, 'percentage': '74.07', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'default_screen_font_scale', 'option': 'false', 'amount': 279891, 'percentage': '37.19', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'default_screen_display_scale', 'option': 'false', 'amount': 170927, 'percentage': '22.7', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'preference_daytime', 'option': 'night', 'amount': 156733, 'percentage': '20.82', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'screen_font_scale_default_comparison', 'option': 'bigger', 'amount': 172957, 'percentage': '22.98', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'screen_display_scale_default_comparison', 'option': 'bigger', 'amount': 111441, 'percentage': '14.8', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'screen_font_scale_default_comparison', 'option': 'default', 'amount': 472851, 'percentage': '62.82', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'screen_display_scale_default_comparison', 'option': 'default', 'amount': 581815, 'percentage': '77.29', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'screen_font_scale_default_comparison', 'option': 'smaller', 'amount': 106934, 'percentage': '14.21', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'screen_display_scale_default_comparison', 'option': 'smaller', 'amount': 59486, 'percentage': '7.9', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'preference_daytime', 'option': 'unknown', 'amount': 132489, 'percentage': '17.6', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'screen_orientation', 'option': 'portrait', 'amount': 749534, 'percentage': '99.57', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'preference_daytime', 'option': 'twilight', 'amount': 169150, 'percentage': '22.47', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}, {'feature': 'screen_orientation', 'option': 'landscape', 'amount': 3209, 'percentage': '0.43', 'date': datetime.date(2023, 3, 10), 'epoch': datetime.datetime(2023, 3, 10, 11, 53, 44, tzinfo=datetime.timezone.utc)}]
        grouped_properties = {}
        for group_key, group_value in groupby(sorted_properties, lambda v: v["feature"]):
            grouped_properties[group_key] = [el for el in group_value]
        return grouped_properties
